<style type="text/css">
    .modal-width-50 .modal-sm {
        width:20%;
    }
    .blue	 {
		color: #5bc0de;
	}
	#loading {
	    height: 100%;
	    position: fixed;
	    z-index: 999;
	    width: 100%;
	    left: 0px;
	    top: 0px;
	    overflow: hidden;
	    background-color: rgba(128,128,128, 0.4);
	    /*opacity: .5;*/
	}
	.loading-element-component {
		text-align: center;
	    margin-top: 20%;
	    font-size:20px;
	}
	.text-yellow{
		color: orange;
	}
    .thread-users span.comma:last-child {
        display: 'none';
    }
    .liked {
        font-weight: bolder;
        background: blue;
    }
    .badge-delete .badge,
    .delete-member.badge{
        background-color: #d9534f!important;
    }
    .badge-edit .badge {
        background-color: #2a6496!important;
    }
    .badge-like, .badge-delete,
    .badge-edit,
    .delete-member,
    .add-member {
        cursor: pointer;
    }
    .red {
        color: #d9534f!important;
    }
</style>

<div id="loading" ng-if="!thread">
	<div class="loading-overlay-component"></div>
	<div class="loading-element-component">
		<i class="blue fa fa-spinner fa-spin fa-4x"></i>
        <p class="text-yellow">LOADING</p>
	</div>
</div>
<div class="panel colourable" ng-if="thread">
    <div class="panel-heading">
        <span class="panel-title">
            <div>
                <label class="lead">
                    <a ui-sref="app.thread({ id: thread.Thread.id })">
                        {{thread.Thread.title}}
                        <span class="badge add-member" title="Add Head" ng-click="addHead(thread.Thread)">
                            <i class="glyphicon glyphicon-plus"></i>
                        </span>
                    </a>
                </label>
            </div>
            <span>
                <!--投稿メンバー-->
                <span class="thread-users" title="members">
                    
                    <i class="glyphicon glyphicon-plus clickable red" ng-if="thread.Owner.id == loginUser.id" ng-click="addMembers(thread.Thread)"></i>
                    
                    
                    <i class="glyphicon glyphicon-user"></i>
                	<span>:</span>
                	<span ng-if="thread.Owner.id > 0">
                		{{thread.Owner.username}}
                		{{thread.User.length ? ', ' : ''}}
                	</span>
                	<span ng-repeat="u in thread.User  | limitTo: noOfUserToView " ng-if="thread.User.length">
                		<span 
                            ng-if="thread.Owner.id > 0 && u.id === loginUser.id"
                            class="badge delete-member" 
                            title="Leave Thread" 
                            ng-click="leaveThread($index, u)">
                            <i class="glyphicon glyphicon-log-out"></i>
                        </span>
                        <span 
                            ng-if="thread.Owner.id == loginUser.id"
                            class="badge delete-member" 
                            title="delete member" 
                            ng-click="deleteMember($index, u)">
                            <i class="glyphicon glyphicon-minus"></i>
                        </span>
                        
                		{{u.username}}
                		
                		{{$last ? '' : ', '}}
                		
                        <a href="javascript:void(0)" ng-if="noOfUserToView < thread.User.length && $last" ng-click="loadUser()">
                            more...
                        </a>
                        <a href="javascript:void(0)" ng-if="noOfUserToView >= thread.User.length && noOfUserToView > 10 && $last" ng-click="hideUser()">
                            hide
                        </a>
                	</span>
                </span>
            </span>
            <br>
            <span ng-if="thread.Owner.id > 0" style="font-size:11px;">
                {{thread.Thread.created}}
            </span>
            <span ng-if="thread.Owner.id == 0" style="font-size:11px;">&nbsp;</span>
        </span>
        <div class="panel-heading-controls">
            <input type="checkbox" 
                                id="notification" 
                                ng-model="thread.Thread.push_notification" 
                                data-size="mini"
                                data-label-text="通知"
                                switch-change="pushNotification()"
                                bootstrap-switch />
            <div class="btn-group btn-group-sm" ng-if="thread.Owner.id == loginUser.id">
                <button class="btn btn-info dropdown-toggle" type="button" data-toggle="dropdown">
                  <span class="fa fa-cog"></span>&nbsp;<span class="fa fa-caret-down"></span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right">
                    <li><a href="" class="clickable" role="button" ng-click="editThread($index, thread)" >編集</a></li>
                    <li><a href="" class="clickable" role="button" ng-click="deleteThread($index, thread.Thread.id)">削除</a></li>
                </ul> <!-- / .dropdown-menu -->
            </div> <!-- / .btn-group -->
        </div> <!-- / .panel-heading-controls -->
    </div> <!-- / .panel-heading -->
    <ul class="list-group" id="threadList" style="overflow-y:scroll">
                    <script type="text/javascript">
                      //読み込み時の表示
                      window_load();

                      //ウィンドウサイズ変更時に更新
                      window.onresize = window_load;

                      //サイズの表示F
                      function window_load() {
                        var sH = window.innerHeight;

                        document.getElementById("threadList").style.height = sH - 200 + "px";

                      }
                    </script>          
      <li class="list-group-item" ng-repeat="head in thread.Head">
         <!--<a ui-sref="app.head({ id: head.id })">-->
         <a class="clickable" id="head-{{head.id}}" ng-click="gotoHead(head)">
            <h5>
                {{head.body}}
                <span class="badge badge-info" ng-init="head.notification_count=getNotificationCount(head.id)">{{head.notification_count}}</span>
            </h5>
        </a>
        
        <span style="font-size:11px;">{{head.created}}</span>
        <span style="font-size:11px;">by: {{head.Owner.username == loginUser.username ? "あなた": head.Owner.username}}</span>
        <div class="panel-heading-controls">
            <span>
                <a href="javascript:void(0)" class="text-xs" ng-if="head.likes_count > 0 && !head.isUserLiked" ng-click="showUsers(head.likes)">
                    {{head.likes_count}} 人がいいね！と言っています
                </a>
                <a href="javascript:void(0)" class="text-xs" ng-if="head.likes_count > 1 && head.isUserLiked" ng-click="showUsers(head.likes)">
                    あなたと {{head.likes_count - 1}} 人がいいね！と言っています
                </a>
                <button ng-if="head.Owner.id != loginUser.id" class="btn btn-sm {{(head.isUserLiked)?'':'btn-outline'}} btn-warning" ng-disabled="head.processing" ng-click="like($index, head)">
                    <span class="fa fa-thumbs-o-up"></span>
                </button>
            </span>
            
            <div class="btn-group btn-group-sm" ng-if="head.Owner.id == loginUser.id">
              <button class="btn btn-info dropdown-toggle" type="button" data-toggle="dropdown">
                  <span class="fa fa-cog"></span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" >
                    <li><a href="" class="clickable" role="button" ng-click="editHead($index, head)">編集</a></li>
                    <li><a href="" class="clickable" role="button" ng-click="deleteHead($index, head.id)">削除</a></li>
                </ul> <!-- / .dropdown-menu -->
            </div> <!-- / .btn-group -->
        </div> <!-- / .panel-heading-controls -->
      </li>
    </ul>
</div> <!-- / .panel -->



<div ng-repeat="template in templates" ng-include="template"></div>