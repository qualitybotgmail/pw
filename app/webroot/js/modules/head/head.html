<style type="text/css">
    .modal-width-50 .modal-sm {
        width:20%;
    }
    p.head-comment,
    p.head-body{
        white-space: pre-line;
    }
    .blue	 {
		color: #5bc0de;
	}
	#loading {
	    height: 100%;
	    position: fixed;
	    z-index: 999;
	    width: 100%;
	    left: 0px;
	    top: 0px;
	    overflow: hidden;
	    background-color: rgba(128,128,128, 0.4);
	    /*opacity: .5;*/
	}
	.loading-element-component {
		text-align: center;
	    margin-top: 20%;
	    font-size:20px;
	}
	.text-yellow{
		color: orange;
	}
    .thread-users span.comma:last-child {
        display: 'none';
    }
    .liked {
        font-weight: bolder;
        background: blue;
    }
    .badge-like,
    .add-member {
        cursor: pointer;
    }
    
</style>

<div id="loading" ng-if="!selectedHead.Thread.id">
	<div class="loading-overlay-component"></div>
	<div class="loading-element-component">
		<i class="blue fa fa-spinner fa-spin fa-4x"></i>
        <p class="text-yellow">LOADING</p>
	</div>
</div>
<div class="panel colourable" ng-if="selectedHead.Thread.id">
    <div class="panel-heading">
        <span class="panel-title">
            <div>
                <small>
                    {{selectedHead.Thread.title}}
                </small>
                <p class="lead head-body" ng-init="fromattedBody=formatComment(selectedHead.Head.body)">
                    {{fromattedBody}}
                </p>
            </div>
            
            <br>
            <span style="font-size:11px;">
                {{selectedHead.Thread.created}}
            </span>
        </span>
        <div class="panel-heading-controls">
            <button class="btn btn-sm {{(selectedHead.Head.isUserLiked)?'':'btn-outline'}} btn-warning" ng-disabled="selectedHead.Head.processing" ng-click="like($index, selectedHead.Head)">
                <span class="fa fa-thumbs-o-up"></span>
            </button>
            <span class="clickable" ng-if="selectedHead.Head.likes_count == 1 && selectedHead.Head.isUserLiked" ng-click="showUsers(selectedHead.Head.likes)">
                You liked this head
            </span>
            <span class="clickable" ng-if="selectedHead.Head.likes_count == 1 && !selectedHead.Head.isUserLiked" ng-click="showUsers(selectedHead.Head.likes)">
                {{selectedHead.Head.likes[0].User.username}} liked this head
            </span>
            <span class="clickable" ng-if="selectedHead.Head.likes_count > 1 && !selectedHead.Head.isUserLiked" ng-click="showUsers(selectedHead.Head.likes)">
                {{selectedHead.Head.likes_count}} liked this head
            </span>
            <span class="clickable" ng-if="selectedHead.Head.likes_count > 1 && selectedHead.Head.isUserLiked" ng-click="showUsers(selectedHead.Head.likes)">
                You and {{selectedHead.Head.likes_count - 1}} liked this head 
            </span>
            
            <div class="btn-group btn-group-sm">
              <button class="btn btn-info dropdown-toggle" type="button" data-toggle="dropdown"><span class="fa fa-cog"></span>&nbsp;<span class="fa fa-caret-down"></span></button>
              <ul class="dropdown-menu dropdown-menu-right">
                <li><a href="" class="clickable" role="button" ng-click="editHead(selectedHead.Head)">編集</a></li>
                <li><a href="" class="clickable" role="button" ng-click="deleteHead(selectedHead.Thread.id, selectedHead.Head.id)">削除</a></li>
              </ul> <!-- / .dropdown-menu -->
            </div> <!-- / .btn-group -->
        </div> <!-- / .panel-heading-controls -->
    </div> <!-- / .panel-heading -->
    <ul class="list-group">
        <li class="list-group-item">
            <div class="row">
                <div class="col-md-12">
                    <p>
                        <span ng-repeat="upload in selectedHead.Upload.non_image">
                            <span ng-init="upload.isFileImage=checkFile(upload.path)"></span>
                            <a ng-href="{{upload.path}}" target="_blank" ng-if="!upload.isFileImage">
                              {{upload.name}}
                            </a>
                            <a fancybox ng-href="{{upload.path}}" ng-if="upload.isFileImage">
                                <img ng-src="{{upload.path}}" class="img-responsive thumbnail" width="150" height="50"></img>
                            </a>
                        </span>
                    </p>
                </div>
            </div>
        </li>
        <li class="list-item" ng-if="selectedHead.Comment.length">
            <ul class="list-group commentList">
                <li class="list-group-item" ng-repeat="c in selectedHead.Comment | unique : 'id'" ng-init="$last && fireMessageEvent()">
                    <small>by : {{c.User.username == loginUser.username ? "You" : c.User.username }}</small>
                    <p class="head-comment" ng-init='c.formattedComment=formatComment(c.body)' >{{c.formattedComment}}</p>
                    <p>
                        <span ng-repeat="u in c.Uploads">
                            <span ng-init="u.isFileImage=checkFile(u.Upload.name)"></span>
                            <a ng-href="{{u.Upload.path}}" target="_blank" ng-if="!u.isFileImage">
                              {{u.Upload.name}}
                            </a>
                            <a fancybox ng-href="{{u.Upload.path}}" ng-if="u.isFileImage">
                                <img ng-src="{{u.Upload.path}}" class="img-responsive thumbnail" width="150" height="50"></img>
                            </a>
                        </span>
                    </p>
                    <span style="font-size:10px;">{{c.created}}</span>
                    <span class="clickable pull-right" ng-if="c.likes_count == 1 && c.isUserLiked" ng-click="showUsers(c.likes)">
                        You liked this head
                    </span>
                    <span class="clickable pull-right" ng-if="c.likes_count == 1 && !c.isUserLiked" ng-click="showUsers(c.likes)">
                        {{c.likes[0].User.username}} liked this head
                    </span>
                    <span class="clickable pull-right" ng-if="c.likes_count > 1 && !c.isUserLiked" ng-click="showUsers(c.likes)">
                        {{c.likes_count}} liked this head
                    </span>
                    <span class="clickable pull-right" ng-if="c.likes_count > 1 && c.isUserLiked" ng-click="showUsers(c.likes)">
                        You and {{c.likes_count - 1}} liked this head 
                    </span>
                    <button class="btn btn-xs {{(c.isUserLiked)?'':'btn-outline'}} btn-warning pull-right" ng-disabled="c.processing" ng-click="likeComment($index, c)">
                        <span class="fa fa-thumbs-o-up"></span>
                    </button>
                </li>
            </ul>
        </li>
        <li class="list-group-item form-group">
            <form  role="form" id="commentFrm" name="commentFrm" method="POST" enctype="multipart/form-data" 
                        novalidate ng-submit="sendComment()">
                
                <input type="text" name="data[Upload][comment_id]" class="hidden" id="comment-id" ng-model="comment.comment_id" />
                <input type="file" name="data[Upload][file]" id="attachments"  multiple />
                <textarea ng-click='textboxClicked()' name="data[Upload][body]" class="form-control" id="body" placeholder="共有したい情報を投稿" ng-model="comment.body"></textarea>
                <button type="submit" class="btn btn-sm btn-primary pull-right" style="margin-top:4px;">コメント</button>
                
            </form>
        </li>
    </ul>
</div> <!-- / .panel -->

<div ng-repeat="template in templates" ng-include="template"></div>